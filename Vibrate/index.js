(function(g,F,S,E,T,j){"use strict";function V(t){const{metro:{findByProps:n,findByStoreName:e,common:{lodash:{merge:r}}}}=t,a=n("_sendMessage"),{createBotMessage:i}=n("createBotMessage"),l=n("BOT_AVATARS"),{getChannelId:s}=e("SelectedChannelStore");return function(p,d){if(p.channelId??=s(),[null,void 0].includes(p.channelId))throw new Error("No channel id to receive the message into (channelId)");let c=p;if(p.really){typeof d=="object"&&(c=r(c,d));const o=[c,{}];o[0].tts??=!1;for(const f of["allowedMentions","messageReference"])f in o[0]&&(o[1][f]=o[0][f],delete o[0][f]);const u="overwriteSendMessageArg2";return u in o[0]&&(o[1]=o[0][u],delete o[0][u]),a._sendMessage(p.channelId,...o)}return d!==!0&&(c=i(c)),typeof d=="object"&&(c=r(c,d),typeof d.author=="object"&&function(){const o=d.author;typeof o.avatarURL=="string"&&(l.BOT_AVATARS[o.avatar??o.avatarURL]=o.avatarURL,o.avatar??=o.avatarURL,delete o.avatarURL)}()),a.receiveMessage(c.channel_id,c),c}}function R(t,n,e){if(!t?.name||!t?.description)throw new Error(`No name(${t?.name}) or description(${t?.description}) in the passed command (command name: ${t?.name})`);if(t.displayName??=n?.names?.[e]??t.name,t.displayDescription??=n?.names?.[e]??t.description,t.options){if(!Array.isArray(t.options))throw new Error(`Options is not an array (received: ${typeof t.options})`);for(var r=0;r<t.options.length;r++){const i=t.options[r];if(!i?.name||!i?.description)throw new Error(`No name(${i?.name}) or description(${i?.description} in the option with index ${r}`);if(i.displayName??=n?.options?.[r]?.names?.[e]??i.name,i.displayDescription??=n?.options?.[r]?.descriptions?.[e]??i.description,i?.choices){if(!Array.isArray(i?.choices))throw new Error(`Choices is not an array (received: ${typeof i.choices})`);for(var a=0;a<i.choices.length;a++){const l=i.choices[a];if(!l?.name)throw new Error(`No name of choice with index ${a} in option with index ${r}`);l.displayName??=n?.options?.[r]?.choices?.[a]?.names?.[e]??l.name}}}}return t}function U(t,n){if(t===void 0)throw new Error("No object passed to make defaults for");if(n===void 0)throw new Error("No defaults object passed to make defaults off of");for(const e in n)typeof n[e]=="object"&&!Array.isArray(n[e])?(typeof t[e]!="object"&&(t[e]={}),U(t[e],n[e])):t[e]??=n[e];return t}const w={getLoading(){return Math.random()<.01?this.aol:this.loadingDiscordSpinner},getFailure(){return Math.random()<.01?this.fuckyoy:this.linuth},getSuccess(){return""},loadingDiscordSpinner:"a:loading:1105495814073229393",aol:"a:aol:1108834296359301161",linuth:":linuth:1110531631409811547",fuckyoy:":fuckyoy:1108360628302782564"},q={command:"https://cdn.discordapp.com/attachments/1099116247364407337/1112129955053187203/command.png"};function D(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:200,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return Array.from({length:n},function(){return`vibrate(duration = ${t})`}).join(e>0?`
wait(time = ${e})
`:`
`)}function k(t,n){return t<0?n??0:t}function C(t){return t.error=!0,t.toString=function(){var n=this;const e=`${this.line} | `,r=this.character+e.length;let a,i;return this.lines&&(a=this.lines.splice(this.line-3,this.line-1).reduce(function(l,s,p){return l+`${p+n.line-3} | ${s}
`},""),i=`
`+this.lines.slice(this.line,this.line+3).reduce(function(l,s,p){return l+`${p+n.line+1} | ${s}
`},"")),a+(`${e}${this.codeline}
`+" ".repeat(k(r-1))+(this.message.length<25?"^"+"-".repeat(k(e.length-r,1))+" ":`\u2191
`+" ".repeat(k(r-1-5)))+"Syntax Error: "+this.message)+i},t}function G(t,n){if(typeof t!="string")throw new Error("passed scheme isn't a string");const e=[],r=t.split(/\r?\n|\r/);for(var a=0;a<r.length;a++){const l=r[a].trimEnd(),[s,p]=l.split(";"),d={name:void 0,rawName:void 0,comment:p,args:[],rawArgs:void 0};if(n&&(d.line=a),!n&&s.length===0||(n&&(d.rawName=s),e.push(d),s.length===0))continue;const c=s.indexOf("("),o=s.indexOf(")");if(s.trimEnd().substring(0,o).length>s.trimEnd().length)return C({message:"Unnecessary symbols after funk brackets",character:o+1,codeline:s,line:a,lines:r});let u;if(c===0?u=s.substring(0,c):o===0?u=s.substring(0,o):u=s.substring(0,c!==-1?c:0),u.length===0&&(c===0||o===0))return C({message:"No funk name",character:1,codeline:s,line:a,lines:r});if(d.name=u.trim(),c===-1&&o===-1)return C({message:'No arg brackets ("(", ")")',character:u.length||1,codeline:s,line:a,lines:r});if(c===-1)return C({message:'No opening arg bracket ("(")',character:o!==-1?o+1:0,codeline:s,line:a,lines:r});if(o===-1)return C({message:'No closing arg bracket (")")',character:c!==-1?c+1:0,codeline:s,line:a,lines:r});const f=s.substring(c+1,o).split(",");n&&(d.rawArgs=f);for(var i=0;i<f.length;i++){const I=f[i],y={name:void 0,rawName:void 0,equalsUsed:void 0,value:void 0,rawValue:void 0};if(!n&&I.length===0){if(i!==0)return C({message:"Empty argument",character:u.length+f.splice(0,i).reduce(function($,M){return $+M.length+1},1),codeline:s,line:a,lines:r});break}d.args.push(y),n&&(y.equalsUsed=I.indexOf("=")!==-1),n&&(y.rawName=b[0]);const b=I.split("=");if(b.length===2&&[b[0],b[1]].every(function($){return $===""}))return C({message:"Empty argument name",character:u.length+f.splice(0,i).reduce(function($,M){return $+M.length+1},1)+I.indexOf("="),codeline:s,line:a,lines:r});b[1]||(b[1]="true"),y.name=b[0].trim();const Z=b[1];n&&y.rawValue;const N=Z.trim(),L=parseInt(N);Number.isNaN(L)?N==="true"?y.value=!0:N==="false"?y.value=!1:y.value=N:y.value=L}}return e}const H={exeCute:async function(t){const n={...A,interaction:{name:"/vibrate start",user:S.findByStoreName("UserStore").getCurrentUser()}};try{const{args:e,channel:r}=t;if(!(e.get("scheme")||e.get("duration")||e.get("repeat")||e.get("gap")))return await m({channelId:r.id,embeds:[{color:h(),type:"rich",title:`<${w.getFailure()}> Please provide a \`scheme\` or choose \`duration\`, \`repeat\` and/or \`gap\``}]},n);const a=e.get("scheme")?.value||D(e.get("duration").value,e.get("repeat")?.value,e.get("gap")?.value);x({scheme:a,parseCB:async function(i){return await m({channelId:r.id,embeds:[{color:h(),type:"rich",title:"<:vibrating:1095354969965731921> Parsing vibration\u2026",footer:{text:`ID: ${i.id}
(if you stop now, it will stop after parsing)`}}]},n)},parseFailCB:async function(i){return await m({channelId:r.id,embeds:[{color:h(),type:"rich",title:`<${w.getFailure()}> An error ocurred while parsing the scheme`,description:`\`\`\`js
${i.scheme.toString()}\`\`\``}]},{...n,id:i.parseCallbackOutput.id,edited_timestamp:Date.now().toString()})},startCB:async function(i){return await m({channelId:r.id,embeds:[{color:h(),type:"rich",title:"<:vibrating:1095354969965731921> Playing vibration",footer:{text:`ID: ${i.id}`}}]},{...n,edited_timestamp:Date.now().toString(),id:i.parseCallbackOutput.id})},errorCB:async function(i){return await m({channelId:r.id,embeds:[{color:h(),type:"rich",title:`${w.getFailure()} An error ocurred while playing the vibration`,description:`\`\`\`${i.error.message}\`\`\``}]},{...n,edited_timestamp:Date.now().toString(),id:i.startCallbackOutput.id})},finishCB:async function(i){const l=i.startCallbackOutput.id;m({channelId:r.id,embeds:[{color:h(),type:"rich",title:`<:still:1095977283212296194> ${i.stopped?"Stopp":"Finish"}ed playing`,footer:{text:`ID: ${i.id}`}}]},{...n,type:19,message_reference:{channel_id:r.id,message_id:l,guild_id:t?.guild?.id},referenced_message:S.findByStoreName("MessageStore").getMessage(r.id,l)})}})}catch(e){console.error(e),m({channelId:channel.id,content:`\`\`\`js
${e.stack}\`\`\``,embeds:[{color:h(),type:"rich",title:`<${w.getFailure()}> An error ocurred while running the command`,description:`Send a screenshot of this error and explain how you came to it, here: ${B}, to hopefully get this error solved!`}]},n)}}},J={exeCute:async function(t){const{channel:n,args:e}=t,r={...A,interaction:{name:"/vibrate stop",user:S.findByStoreName("UserStore").getCurrentUser()}};try{const a=e.get("id").value;if(v.findIndex(function(l){return l.id===a})===-1){await m({channelId:n.id,embeds:[{color:h(),type:"rich",title:`<${w.getFailure()}> Vibration with id \`${a}\` not found`}]},r);return}const i=v[v.findIndex(function(l){return l.id===a})];i.stopping=!0,i.startCallbackOutput=m({channelId:n.id,embeds:[{color:h(),type:"rich",title:`<${w.getLoading()}> Stopping vibration\u2026`,footer:{text:`ID: ${i.id}`}}]},r)}catch(a){console.error(a),m({color:h(),channelId:n.id,content:`\`\`\`js
${a.stack}\`\`\``,embeds:[{type:"rich",title:`<${w.getFailure()}> An error ocurred while running the command`,description:`Send a screenshot of this error and explain how you came to it, here: ${B}, to hopefully get this error solved!`}]},r)}}},B="||not proxied||",K="1113021888109740083",A={author:{username:"Vibrate",avatar:"command",avatarURL:q.command}};U(vendetta.plugin.storage,{stats:{localRuns:0,publicRuns:0,lastVibration:{scheme:D(150,5)}}});const{meta:{resolveSemanticColor:W}}=S.findByProps("colors","meta"),Y=S.findByStoreName("ThemeStore"),h=function(){return parseInt(W(Y.theme,j.semanticColors.BACKGROUND_SECONDARY).slice(1),16)};let O;function m(){return window.sendMessage?window.sendMessage?.(...arguments):(O||(O=V(vendetta)),O(...arguments))}const{triggerHaptic:P}=S.findByProps("triggerHaptic"),z=E.ReactNative.Platform.select,_=function(t){return new Promise(function(n){return setTimeout(n,t)})};let Q=0;const v=[];async function x(t){try{if(typeof t>"u"&&(t={}),!t?.scheme)throw new Error("No scheme provided");const e={id:Q++,meta:{rawScheme:t.scheme},stopping:!1,stopped:!1,ios:!!z({ios:!0})};if(t?.parseCB&&(e.parseCallbackOutput=await t.parseCB(e)),e.scheme=G(e.meta.rawScheme,t?.debug),v.push(e),console.log("VIBRATION",e),e.scheme.error===!0&&(e.errored=!0,t?.parseFailCB&&(e.errorCallbackOutput=await t.parseFailCB(e))),!e.errored&&t?.startCB&&(e.startCallbackOutput=await t.startCB?.(e)),!e.errored){T.storage.localRuns++;for(var n of e.scheme){if(!n.name)continue;const r=n.args.find(function(a){return a.name==="duration"})?.value;switch(n.name){case"vibrate":if(e.ios){P();const a=setInterval(P,1);await _(r??400),clearInterval(a)}else E.ReactNative.Vibration.vibrate(r??400),await _(r??400);break;case"wait":await _(r??5);break;default:e.errored=!0,e.stopping=!0,e.error={message:"Unknown funk: "+n.name},t?.errorCB&&(e.errorCallbackOutput=t.errorCB(e))}if(e.stopping===!0){e.stopped=!0;break}if(e.errored)break}}return v.splice(v.findIndex(function(r){return r.id===e.id}),1),e.errored?e.errorCallbackOutput:t?.finishCB?.(e)}catch(e){console.error(e),alert(`An error ocurred at vibrate()
`+e.stack)}}var X={meta:vendetta.plugin,patches:[],onUnload(){this.patches.forEach(function(t){return t()}),this.patches=[]},onLoad(){var t=this;this.patches.push(function(){for(var n=0;n<v.length;n++)v[n].stopping=!0});try{const n=this;[R({async execute(e,r){return await J.exeCute({...r,args:new Map(e.map(function(a){return[a.name,a]})),command:this,plugin:n})},type:1,inputType:1,applicationId:"-1",name:"vibrate stop",description:"Stop a brrr",options:[{type:4,required:!0,name:"id",description:"Vibration id which you receive when starting a vibration"}]}),R({async execute(e,r){return await H.exeCute({...r,args:new Map(e.map(function(a){return[a.name,a]})),command:this,plugin:n})},type:1,inputType:1,applicationId:"-1",name:"vibrate start",description:"Start a brrr",options:[{type:3,name:"scheme",description:"A custom scheme to use (overwrites all other options)",min_length:1},{type:4,name:"duration",description:"Duration of one vibration (ms)",min_value:1},{type:4,name:"repeat",description:"Number of times to repeat"},{type:4,name:"gap",description:"Wait between vibrations (only matters if you have more than 1 repeat)"}]})].forEach(function(e){return t.patches.unshift(F.registerCommand(e))})}catch(n){console.error(n),alert(`There was an error while loading Vibrate
`+n.stack)}}};return g.APP_ID=K,g.EMBED_COLOR=h,g.PLUGIN_FORUM_POST_URL=B,g.authorMods=A,g.default=X,g.sendMessage=m,g.vibrate=x,g.vibrations=v,Object.defineProperty(g,"__esModule",{value:!0}),g})({},vendetta.commands,vendetta.metro,vendetta.metro.common,vendetta.plugin,vendetta.ui);
